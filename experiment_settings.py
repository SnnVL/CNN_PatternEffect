"""Experimental settings for manuscript
Convolutional Neural Networks trained on internal variability predict radiation under strong climate change by learning the pattern effect


Functions
---------
get_settings(experiment_name)
"""
import numpy as np

__author__ = "Maria Rugenstein, Elizabeth A. Barnes, and Senne Van Loon"
__date__ = "7 March 2024"


def get_settings(experiment_name):
    experiments = {

        # Green's function
        "MPI_GF": {  
            "presaved_data_filename": None,
            "input_region": "mask_MPI.nc",
            "datafolder": "MPI_hist_rcp85/",
            "detrend": True,
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,

            "data_period":"_1870-2099",
            "input_var": "tas", 
            "label_var": "radiation", 
            "label_type": "None",
            "n_train_val_test": (80, 10, 10),

            "network_type": "ffn",
            "hiddens": [1, ],
            "act_fun": ["linear", ],
            "ridge_param": [0.0, ],
            "dropout_rate": [0.0, ],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": [3, ],
            "n_epochs": 0,
            "patience": 0,
        },

        # Internal Variability
        "MPI_IV": {
            "presaved_data_filename": None,
            "input_region": "mask_MPI.nc",
            "detrend": True,
            "datafolder": "MPI_hist_rcp85/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,

            "data_period":"_1870-2099",
            "input_var": "tas", 
            "label_var": "radiation", 
            "label_type": "None",
            "n_train_val_test": (80, 10, 10),

            "network_type": "cnn",
            "kernel_size": 5,
            "kernels": [32, 32],
            "kernel_act": ["relu", "relu"],
            "hiddens": [16, 8],
            "act_fun": ["relu", "relu"],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": [3, ],
            "n_epochs": 25_000,
            "patience": 10,
        },
        "MPI_IV_linear": {
            "presaved_data_filename": None,
            "input_region": "mask_MPI.nc",
            "detrend": True,
            "datafolder": "MPI_hist_rcp85/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,

            "data_period":"_1870-2099",
            "input_var": "tas", 
            "label_var": "radiation", 
            "label_type": "None",
            "n_train_val_test": (80, 10, 10),

            "network_type": "ffn",
            "hiddens": [1, ],
            "act_fun": ["linear", ],
            "ridge_param": [0.25, ],
            "dropout_rate": [0.25, ],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": [3, ],
            "n_epochs": 25_000,
            "patience": 10,
        },

        # Hyperparameter tuning
        "MPI_IV_hpt000": {
            "presaved_data_filename": None,
            "input_region": "mask_MPI.nc",
            "detrend": True,
            "datafolder": "MPI_hist_rcp85/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,

            "data_period":"_1870-2099",
            "input_var": "tas", 
            "label_var": "radiation", 
            "label_type": "None",
            "n_train_val_test": (80, 10, 10),

            "network_type": "cnn",
            "kernel_size": 5,
            "kernels": [32, 32, 32],
            "kernel_act": ["relu", "relu", "relu"],
            "hiddens": [16, 8],
            "act_fun": ["relu", "relu"],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": np.arange(5).tolist(),
            "n_epochs": 25_000,
            "patience": 10,
        },
        "MPI_IV_hpt001": {
            "presaved_data_filename": None,
            "input_region": "mask_MPI.nc",
            "detrend": True,
            "datafolder": "MPI_hist_rcp85/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,

            "data_period":"_1870-2099",
            "input_var": "tas", 
            "label_var": "radiation", 
            "label_type": "None",
            "n_train_val_test": (80, 10, 10),

            "network_type": "cnn",
            "kernel_size": 5,
            "kernels": [32, 32, 32],
            "kernel_act": ["relu", "relu", "relu"],
            "hiddens": [16, 8],
            "act_fun": ["relu", "relu"],
            "learning_rate": 0.00005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": np.arange(5).tolist(),
            "n_epochs": 25_000,
            "patience": 10,
        },
        "MPI_IV_hpt002": {
            "presaved_data_filename": None,
            "input_region": "mask_MPI.nc",
            "detrend": True,
            "datafolder": "MPI_hist_rcp85/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,

            "data_period":"_1870-2099",
            "input_var": "tas", 
            "label_var": "radiation", 
            "label_type": "None",
            "n_train_val_test": (80, 10, 10),

            "network_type": "cnn",
            "kernel_size": 5,
            "kernels": [32, 32, 32],
            "kernel_act": ["relu", "relu", "relu"],
            "hiddens": [16, 8],
            "act_fun": ["relu", "relu"],
            "learning_rate": 0.0000025,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": np.arange(5).tolist(),
            "n_epochs": 25_000,
            "patience": 10,
        },
        "MPI_IV_hpt003": {
            "presaved_data_filename": None,
            "input_region": "mask_MPI.nc",
            "detrend": True,
            "datafolder": "MPI_hist_rcp85/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,

            "data_period":"_1870-2099",
            "input_var": "tas", 
            "label_var": "radiation", 
            "label_type": "None",
            "n_train_val_test": (80, 10, 10),

            "network_type": "cnn",
            "kernel_size": 5,
            "kernels": [32, 32],
            "kernel_act": ["relu", "relu"],
            "hiddens": [16, 8],
            "act_fun": ["relu", "relu"],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": np.arange(5).tolist(),
            "n_epochs": 25_000,
            "patience": 10,
        },
        "MPI_IV_hpt004": {
            "presaved_data_filename": None,
            "input_region": "mask_MPI.nc",
            "detrend": True,
            "datafolder": "MPI_hist_rcp85/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,

            "data_period":"_1870-2099",
            "input_var": "tas", 
            "label_var": "radiation", 
            "label_type": "None",
            "n_train_val_test": (80, 10, 10),

            "network_type": "cnn",
            "kernel_size": 5,
            "kernels": [64, 64, 64],
            "kernel_act": ["relu", "relu", "relu"],
            "hiddens": [16, 8],
            "act_fun": ["relu", "relu"],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": np.arange(5).tolist(),
            "n_epochs": 25_000,
            "patience": 10,
        },
        "MPI_IV_hpt005": {
            "presaved_data_filename": None,
            "input_region": "mask_MPI.nc",
            "detrend": True,
            "datafolder": "MPI_hist_rcp85/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,

            "data_period":"_1870-2099",
            "input_var": "tas", 
            "label_var": "radiation", 
            "label_type": "None",
            "n_train_val_test": (80, 10, 10),

            "data_period":"_1870-2099",
            "network_type": "cnn",
            "kernel_size": 5,
            "kernels": [32, 32, 32, 32],
            "kernel_act": ["relu", "relu", "relu", "relu"],
            "hiddens": [16, 8],
            "act_fun": ["relu", "relu"],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": np.arange(5).tolist(),
            "n_epochs": 25_000,
            "patience": 10,
        },
        "MPI_IV_hpt006": {
            "presaved_data_filename": None,
            "input_region": "mask_MPI.nc",
            "detrend": True,
            "datafolder": "MPI_hist_rcp85/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,

            "data_period":"_1870-2099",
            "input_var": "tas", 
            "label_var": "radiation", 
            "label_type": "None",
            "n_train_val_test": (80, 10, 10),

            "network_type": "cnn",
            "kernel_size": 5,
            "kernels": [32, 32, 32],
            "kernel_act": ["relu", "relu", "relu"],
            "hiddens": [8, 8, 8],
            "act_fun": ["relu", "relu", "relu"],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": np.arange(5).tolist(),
            "n_epochs": 25_000,
            "patience": 10,
        },
        "MPI_IV_hpt007": {
            "presaved_data_filename": None,
            "input_region": "mask_MPI.nc",
            "detrend": True,
            "datafolder": "MPI_hist_rcp85/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,

            "data_period":"_1870-2099",
            "input_var": "tas", 
            "label_var": "radiation", 
            "label_type": "None",
            "n_train_val_test": (80, 10, 10),

            "network_type": "cnn",
            "kernel_size": 5,
            "kernels": [32, 32, 32],
            "kernel_act": ["relu", "relu", "relu"],
            "hiddens": [16],
            "act_fun": ["relu"],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": np.arange(5).tolist(),
            "n_epochs": 25_000,
            "patience": 10,
        },
        "MPI_IV_hpt008": {
            "presaved_data_filename": None,
            "input_region": "mask_MPI.nc",
            "detrend": True,
            "datafolder": "MPI_hist_rcp85/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,

            "data_period":"_1870-2099",
            "input_var": "tas", 
            "label_var": "radiation", 
            "label_type": "None",
            "n_train_val_test": (80, 10, 10),

            "network_type": "cnn",
            "kernel_size": 5,
            "kernels": [32, 32, 32],
            "kernel_act": ["relu", "relu", "relu"],
            "hiddens": [32, 16],
            "act_fun": ["relu", "relu"],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": np.arange(5).tolist(),
            "n_epochs": 25_000,
            "patience": 10,
        },

        # Data with trends (2 different base states)
        "MPI_hist_rcp85": {
            "presaved_data_filename": None,
            "input_region": "mask_MPI.nc",
            "detrend": False,
            "datafolder": "MPI_hist_rcp85/",
            "anomalies": "norm_1870-1900.pickle",
            "remove_map_mean": False,

            "data_period":"_1870-2099",
            "input_var": "tas", 
            "label_var": "radiation", 
            "label_type": "None",
            "n_train_val_test": (80, 10, 10),

            "rng_seed": None,
            "rng_seed_list": [3, ],
        },
        "MPI_1pct": {
            "presaved_data_filename": None,
            "input_region": "mask_MPI.nc",
            "detrend": "1pctCO2",
            "datafolder": "1pct/",
            "anomalies": "norm_1870-1900.pickle",
            "remove_map_mean": False,

            "label_var": "radiation", 
            "label_type": "None",
            "n_train_val_test": (80, 10, 10),

            "rng_seed": None,
            "rng_seed_list": [3, ],
        },


        # Different models
        "CanESM5_IV": {
            "presaved_data_filename": None,
            "input_region": "mask_CanESM5.nc",
            "detrend": True,
            "datafolder": "hist_ssp245/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,
            "maskout_land": False,

            "data_period":"_1850-2100",
            "input_var": "tas_CanESM5", 
            "label_var": "R_CanESM5", 
            "label_type": "None",
            "n_train_val_test": (19, 3, 3),

            "network_type": "cnn",
            "kernel_size": 5,
            "kernels": [32, 32],
            "kernel_act": ["relu", "relu"],
            "hiddens": [16, 8],
            "act_fun": ["relu", "relu"],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": [3, ],
            "n_epochs": 25_000,
            "patience": 10,
        },
        "IPSL_128x64_IV": {
            "presaved_data_filename": None,
            "input_region": "mask_CanESM5.nc",
            "detrend": True,
            "datafolder": "grid_128_64/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,
            "maskout_land": False,

            "data_period":"_1850-2059",
            "input_var": "tas_IPSL-CM6A-LR", 
            "label_var": "R_IPSL-CM6A-LR", 
            "label_type": "None",
            "n_train_val_test": (23, 4, 4),

            "network_type": "cnn",
            "kernel_size": 5,
            "kernels": [32, 32],
            "kernel_act": ["relu", "relu"],
            "hiddens": [16, 8],
            "act_fun": ["relu", "relu"],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": [3, ],
            "n_epochs": 25_000,
            "patience": 10,
        },
        "MIROC6_128x64_IV": {
            "presaved_data_filename": None,
            "input_region": "mask_CanESM5.nc",
            "detrend": True,
            "datafolder": "grid_128_64/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,
            "maskout_land": False,

            "data_period":"_1850-2039",
            "input_var": "tas_MIROC6", 
            "label_var": "R_MIROC6", 
            "label_type": "None",
            "n_train_val_test": (40, 5, 5),

            "network_type": "cnn",
            "kernel_size": 5,
            "kernels": [32, 32],
            "kernel_act": ["relu", "relu"],
            "hiddens": [16, 8],
            "act_fun": ["relu", "relu"],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": [3, ],
            "n_epochs": 25_000,
            "patience": 10,
        },
        "MPI_128x64_IV": {
            "presaved_data_filename": None,
            "input_region": "mask_CanESM5.nc",
            "detrend": True,
            "datafolder": "grid_128_64/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,
            "maskout_land": False,

            "data_period":"_1870-2099",
            "input_var": "tas_MPI-ESM", 
            "label_var": "R_MPI-ESM", 
            "label_type": "None",
            "n_train_val_test": (80, 10, 10),

            "network_type": "cnn",
            "kernel_size": 5,
            "kernels": [32, 32],
            "kernel_act": ["relu", "relu"],
            "hiddens": [16, 8],
            "act_fun": ["relu", "relu"],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": [3, ],
            "n_epochs": 25_000,
            "patience": 10,
        },

        "CanESM5_IV_linear": {
            "presaved_data_filename": None,
            "input_region": "mask_CanESM5.nc",
            "detrend": True,
            "datafolder": "hist_ssp245/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,
            "maskout_land": False,

            "data_period":"_1850-2100",
            "input_var": "tas_CanESM5", 
            "label_var": "R_CanESM5", 
            "label_type": "None",
            "n_train_val_test": (19, 3, 3),

            "network_type": "ffn",
            "hiddens": [1, ],
            "act_fun": ["linear", ],
            "ridge_param": [0.25, ],
            "dropout_rate": [0.25, ],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": [3, ],
            "n_epochs": 25_000,
            "patience": 10,
        },
        "IPSL_128x64_IV_linear": {
            "presaved_data_filename": None,
            "input_region": "mask_CanESM5.nc",
            "detrend": True,
            "datafolder": "grid_128_64/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,
            "maskout_land": False,

            "data_period":"_1850-2059",
            "input_var": "tas_IPSL-CM6A-LR", 
            "label_var": "R_IPSL-CM6A-LR", 
            "label_type": "None",
            "n_train_val_test": (23, 4, 4),

            "network_type": "ffn",
            "hiddens": [1, ],
            "act_fun": ["linear", ],
            "ridge_param": [0.25, ],
            "dropout_rate": [0.25, ],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": [3, ],
            "n_epochs": 25_000,
            "patience": 10,
        },
        "MIROC6_128x64_IV_linear": {
            "presaved_data_filename": None,
            "input_region": "mask_CanESM5.nc",
            "detrend": True,
            "datafolder": "grid_128_64/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,
            "maskout_land": False,

            "data_period":"_1850-2039",
            "input_var": "tas_MIROC6", 
            "label_var": "R_MIROC6", 
            "label_type": "None",
            "n_train_val_test": (40, 5, 5),

            "network_type": "ffn",
            "hiddens": [1, ],
            "act_fun": ["linear", ],
            "ridge_param": [0.25, ],
            "dropout_rate": [0.25, ],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": [3, ],
            "n_epochs": 25_000,
            "patience": 10,
        },
        "MPI_128x64_IV_linear": {
            "presaved_data_filename": None,
            "input_region": "mask_CanESM5.nc",
            "detrend": True,
            "datafolder": "grid_128_64/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,
            "maskout_land": False,

            "data_period":"_1870-2099",
            "input_var": "tas_MPI-ESM", 
            "label_var": "R_MPI-ESM", 
            "n_train_val_test": (80, 10, 10),

            "network_type": "ffn",
            "hiddens": [1, ],
            "act_fun": ["linear", ],
            "ridge_param": [0.25, ],
            "dropout_rate": [0.25, ],
            "learning_rate": 0.000005,
            "batch_size": 32,
            "rng_seed": None,
            "rng_seed_list": [3, ],
            "n_epochs": 25_000,
            "patience": 10,
        },

        # Data with trends 
        "CanESM5_hist_ssp245": {
            "presaved_data_filename": None,
            "input_region": "mask_CanESM5.nc",
            "detrend": False,
            "datafolder": "hist_ssp245/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,
            "maskout_land": False,

            "data_period":"_1850-2100",
            "input_var": "tas_CanESM5", 
            "label_var": "R_CanESM5", 
            "label_type": "None",
            "n_train_val_test": (19, 3, 3),

            "rng_seed": None,
            "rng_seed_list": [3, ],
        },
        "IPSL_128x64_hist_ssp245": {
            "presaved_data_filename": None,
            "input_region": "mask_CanESM5.nc",
            "detrend": False,
            "datafolder": "grid_128_64/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,
            "maskout_land": False,

            "data_period":"_1850-2059",
            "input_var": "tas_IPSL-CM6A-LR", 
            "label_var": "R_IPSL-CM6A-LR", 
            "label_type": "None",
            "n_train_val_test": (23, 4, 4),

            "rng_seed": None,
            "rng_seed_list": [3, ],
        },
        "MIROC6_128x64_hist_ssp245": {
            "presaved_data_filename": None,
            "input_region": "mask_CanESM5.nc",
            "detrend": False,
            "datafolder": "grid_128_64/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,
            "maskout_land": False,

            "data_period":"_1850-2039",
            "input_var": "tas_MIROC6", 
            "label_var": "R_MIROC6", 
            "label_type": "None",
            "n_train_val_test": (40, 5, 5),

            "rng_seed": None,
            "rng_seed_list": [3, ],
        },
        "MPI_128x64_hist_rcp85": {
            "presaved_data_filename": None,
            "input_region": "mask_CanESM5.nc",
            "detrend": False,
            "datafolder": "grid_128_64/",
            "anomalies": True,
            "anomalies_years": (0, 30),
            "remove_map_mean": False,
            "maskout_land": False,

            "data_period":"_1870-2099",
            "input_var": "tas_MPI-ESM", 
            "label_var": "R_MPI-ESM", 
            "label_type": "None",
            "n_train_val_test": (80, 10, 10),

            "rng_seed": None,
            "rng_seed_list": [3, ],
        },
    }

    exp_dict = experiments[experiment_name]
    exp_dict['exp_name'] = experiment_name
    exp_dict['n_members'] = int(np.sum(exp_dict["n_train_val_test"]))

    return exp_dict
